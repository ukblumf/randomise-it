{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Randomise iT- Editing Screen{% endblock %}

{% block page_content %}
<div class="container-fluid">
    <div class="row">
        <label for="tagFilter">Tag:</label>
        <select id="tagFilter">
            <option label="" selected></option>
            {% for tag in tags %}
                <option label="{{ tag.id}}">{{ tag.id }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="row">
		<div class="col-md-4">
            <h2>Sets</h2>
        </div>
		<div class="col-md-4">
            <h2>Macros</h2>
        </div>
		<div class="col-md-4">
            <h2>Tables</h2>
        </div>
    </div>
    <div class="row">
		<div class="col-md-4">
            <input class="form-control" id="setFilter" type="text" placeholder="Search..">
            <table class="table table-striped table-bordered fixed_header">
                <thead>
                    <tr>
                      <th>Name (click to edit)</th>
                    </tr>
                </thead>
                <tbody id="setList" style="height: 200px">
                {% for set in sets %}
                    <tr data-tag="{{ set.tags }}">
                        <td><a href="{{ url_for('.edit_set', id=set.id) }}">{{ set.name }}</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
		<div class="col-md-4">
            <input class="form-control" id="macroFilter" type="text" placeholder="Search..">
            <table class="table table-striped table-bordered fixed_header">
                <thead>
                    <tr>
                      <th>Name (click to edit)</th>
                    </tr>
                </thead>
                <tbody id="macroList" style="height: 200px">
                {% for macro in macro_list %}
                    <tr data-tag="{{ macro.tags }}">
                        <td><a href="{{ url_for('.edit_macro', id=macro.id) }}">{{ macro.name }}</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
		<div class="col-md-4">
            <input class="form-control" id="tableFilter" type="text" placeholder="Search..">
            <table class="table table-striped table-bordered fixed_header">
                <thead>
                    <tr>
                      <th>Name (click to edit)</th>
                    </tr>
                </thead>
                <tbody id="tableList" style="height: 200px">
                {% for table in tables %}
                    <tr data-tag="{{ table.tags }}">
                        <td><a href="{{ url_for('.edit_table', id=table.id) }}">{{ table.name }} <small class="text-muted">({{ table.row_count}})</small></a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
		<div class="col-md-4">
            <h2>Market Products</h2>
        </div>
        <div class="col-md-4">
            <h2>Stories</h2>
        </div>
    </div>
    <div class="row">
		<div class="col-md-4">
            <input class="form-control" id="marketFilter" type="text" placeholder="Search..">
            <table class="table table-striped table-bordered fixed_header">
                <thead>
                    <tr>
                      <th>Name (click to edit)</th>
                    </tr>
                </thead>
                <tbody id="marketList" style="height: 200px">
                {% for market_product in market_products %}
                    <tr>
                        <td><a href="{{ url_for('.edit_market_product', id=market_product.id) }}">{{ market_product.name }}</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-md-4">
            <input class="form-control" id="storyFilter" type="text" placeholder="Search..">
            <table class="table table-striped table-bordered fixed_header">
                <thead>
                    <tr>
                      <th>Name (click to edit)</th>
                    </tr>
                </thead>
                <tbody id="storyList" style="height: 200px">
                {% for story in stories %}
                    <tr>
                        <td><a href="{{ url_for('.edit_story', id=story.id) }}">{{ story.title }}</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
    $(document).ready(function () {
        function filterList(list, filter, tag) {
            $("#" + list + " tr").filter(function () {
                $(this).toggle(($(this).text().toLowerCase().indexOf(filter) > -1 || filter == '') && (tag == "" || $(this).data('tag') == tag));
            });
        }

        $("#tagFilter").change(function () {
            let tag = $(this).children("option:selected").val();
            filterList('tableList', $("#tableFilter").val().toLowerCase(), tag);
            filterList('macroList', $("#macroFilter").val().toLowerCase(), tag);
            filterList('setList', $("#setFilter").val().toLowerCase(), tag);
            filterList('marketList', $("#marketFilter").val().toLowerCase(), tag);
        });
        $("#tableFilter").on("keyup", function () {
            filterList('tableList', $("#tableFilter").val().toLowerCase(), $("#tagFilter").children("option:selected").val());
        });
        $("#macroFilter").on("keyup", function () {
            filterList('macroList', $("#macroFilter").val().toLowerCase(), $("#tagFilter").children("option:selected").val());
        });
        $("#setFilter").on("keyup", function () {
            filterList('setList', $("#setFilter").val().toLowerCase(), $("#tagFilter").children("option:selected").val());
        });
        $("#marketFilter").on("keyup", function () {
            filterList('marketList', $("#marketFilter").val().toLowerCase(), $("#tagFilter").children("option:selected").val());
        });

        $("#storyFilter").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#storyList tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>
{% endblock %}
