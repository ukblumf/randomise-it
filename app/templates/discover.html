{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Randomise iT- View Marketplace{% endblock %}

{% block page_content %}
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#free">Free</a></li>
        <li><a data-toggle="tab" href="#paid">Paid</a></li>
    </ul>
    <div class="tab-content">
        <div id="free" class="tab-pane fade in active">
            <div class="col-md-4">
                <h3>Free</h3>
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Select</th>
                    </tr>
                    </thead>
                    <tbody id="freeList" style="height: 400px">
                    {% for p in free_products %}
                        <tr id="free.{{ p.id }}">
                            <td>
                                <button onclick="previewItem('free.{{ p.id }}');">{{ p.title }}</button>
                            </td>
                            <td>{{ p.description }}</td>
                            <td>
                                <button onclick='selectItem({{ p.id }});'>Select</button>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-md-8">
                <h3>Preview</h3>
                <div class="col-md-4 panel panel-default">
                    <div class="panel-heading">Collections</div>
                    <div class="panel-body" id="preview-panel-collections">
                    </div>
                </div>
                <div class="col-md-4 panel panel-default">
                    <div class="panel-heading">Macros</div>
                    <div class="panel-body" id="preview-panel-macros">
                    </div>
                </div>
                <div class="col-md-4 panel panel-default">
                    <div class="panel-heading">Tables</div>
                    <div class="panel-body" id="preview-panel-tables">
                    </div>
                </div>
            </div>
        </div>
        <div id="paid" class="tab-pane fade">
            <h3>Paid for</h3>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-4">
                        <h3>Categories</h3>
                        <div style="height: 500px; overflow-y: scroll;">
                            <ul class="list-group" id="categoryList">
                                {% for category in used_categories %}
                                    <li class="list-group-item">
                                        <button onclick="selectCategory('{{ category[0] }}');">{{ category[1] }}</button>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h3>Latest</h3>
                        <div style="height: 500px; overflow-y: scroll;">
                            <ul class="list-group" id="latestProducts">
                                {% for mp in latest_marketproducts %}
                                    <li class="list-group-item">
                                        <button onclick="alert('{{ mp.id }}');">{{ mp.name }}</button>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h3>Most Popular</h3>
                        <div style="height: 500px; overflow-y: scroll;">
                            <ul class="list-group" id="popularProducts">
                                {% for mp in popular_marketproducts %}
                                    <li class="list-group-item">
                                        <button onclick="alert('{{ mp.id }}');">{{ mp.name }}</button>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
{% block scripts %}
    {{ super() }}
    <script>
        function selectCategory(catId) {
            // TODO rebuild this functionality with jquery
        }

        function selectItem(publicId) {
            const url = "{{ url_for('.transfer_public_content', public_id='') }}" + publicId;
            $.ajax({
                type: "POST",
                url: url, success: function (result) {
                    alert(JSON.stringify(result));
                }
            })
        }

        function previewItem(id) {
            const url = "{{ url_for('.get_public_content', public_id='') }}" + id;
            $.ajax({
                url: url, success: function (result) {
                    let colls = '';
                    for (c in result.collections) {
                        colls += result.collections[c] + '<br/>';
                    }
                    let macs = '';
                    for (m in result.macros) {
                        macs += result.macros[m] + '<br/>';
                    }
                    let tabs = '';
                    for (t in result.tables) {
                        tabs += result.tables[t] + '<br/>';
                    }
                    $("#preview-panel-collections").html(colls);
                    $("#preview-panel-macros").html(macs);
                    $("#preview-panel-tables").html(tabs);
                }
            });
        }

    </script>
{% endblock %}